# Copyright 2019 The ChromiumOS Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# Description
# This test records power related statistics while the system is idling.
#
#     Current tests,
#
#       | test# | seconds | display   | bluetooth |
#       -------------------------------------------
#       | 1     | 120     | off       | off       |
#       | 2     | 120     | default   | off       |
#       | 3     | 120     | default   | on - idle |
#       | 4     | 120     | off       | on - idle |

NAME = "power_Idle.perf"
METADATA = {
    "contacts": ["cros-power-notifications@google.com"],
    "author": "ChromeOS Team",
    "bug_component": "b:1361410",
    "criteria": "This test is a benchmark",
    "hw_agnostic": False,
}
ATTRIBUTES = ""
TEST_TYPE = "client"

args_dict = utils.args_to_dict(args)

kwargs = {
  'tast_bundle_path': args_dict.get('tast_bundle_path'),
  'pdash_note': args_dict.get('pdash_note', ''),
  'tag': NAME.split('.')[1]
}

if 'idle_secs' in args_dict:
  kwargs['idle_secs'] = float(args_dict['idle_secs'])

if 'warmup_secs' in args_dict:
  kwargs['warmup_secs'] = float(args_dict['warmup_secs'])

job.default_profile_only = True
job.profilers.add('top')
job.profilers.add('turbostat')
job.profilers.add('cros_perf', interval=30)

job.run_test('power_Idle', **kwargs)

job.profilers.delete('cros_perf')
job.profilers.delete('top')
job.profilers.delete('turbostat')
