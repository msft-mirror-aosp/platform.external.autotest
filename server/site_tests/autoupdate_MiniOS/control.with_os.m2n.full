# Copyright 2022 The ChromiumOS Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

AUTHOR = "yuanpengni, ChromiumOS"
NAME = "autoupdate_MiniOS.with_os.m2n.full"
METADATA = {
  "contacts": [
    "chromeos-core-services@google.com",
  ],
  "bug_component": "b:908319",
  "criteria": "Test MiniOS M-to-N update with CrOS using full payload."
}
TIME = "MEDIUM"
TEST_TYPE = "server"
DEPENDENCIES = "servo_state:WORKING"
HW_DEPS = ['minios']
ATTRIBUTES = "suite:nbr-au"
DOC = """
This tests the MiniOS update with the platform (OS) update. The M2N test
provisions the DUT with stable version of the OS and miniOS, and updates
to the version specified by the `build` parameter or `job_repo_url`.
Use the `running_at_desk` arg when testing locally.

Example usage:
test_that autoupdate_MiniOS.with_os.m2n.full <DUT> --board=<board> --args="running_at_desk=True"
"""

from autotest_lib.client.common_lib import utils
args_dict = utils.args_to_dict(args)
servo_args = hosts.CrosHost.get_servo_arguments(args_dict)

def run(machine):
    host = hosts.create_host(machine, servo_args=servo_args)
    job.run_test('autoupdate_MiniOS', host=host, full_payload=True,
                 with_os=True, m2n=True, **args_dict)

job.parallel_simple(run, machines)
