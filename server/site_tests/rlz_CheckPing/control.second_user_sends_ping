# Copyright 2020 The ChromiumOS Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

AUTHOR = "kyleshima, ChromiumOS"
NAME = "rlz_CheckPing.second_user_sends_ping"
METADATA = {
    "contacts": ["chromeos-sw-engprod@google.com"],
    "bug_component": "b:1456157",
    "criteria": "Tests that CAF RLZ ping can be sent by a second user.",
}
TIME = "Short"
TEST_TYPE = "server"
ATTRIBUTES = "suite:rlz"
PY_VERSION = 3
DOC = """
This tests that the RLZ first-use event (CAF) ping will be sent by the second
user, if it was not sent by the first user to log in. It also verifies that
the ping is not resent when the first user logs in again after the ping.
"""

import datetime

def run(machine):
    host = hosts.create_host(machine)
    rlz_embargo_end_date = (datetime.date.today() - datetime.timedelta(days=2))
    job.run_test('rlz_CheckPing', host=host, pre_login='no_lock',
                 rlz_embargo_end_date=rlz_embargo_end_date,
                 check_ping_not_resent=True)

job.parallel_simple(run, machines)
