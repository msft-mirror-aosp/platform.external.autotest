# Copyright 2023 The ChromiumOS Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

from autotest_lib.server import utils

AUTHOR = "ChromeOS Team"
NAME = "platform_ServoPowerStateController.labstation"
METADATA = {
        "contacts": ["peep-fleet-infra-sw@google.com"],
        "bug_component": "b:1305623",#Chrome Operations > Fleet > Software > OS Fleet Automation > Labstation
        "criteria": "Verify servo PowerStateController functions"
}
TIME = "LONG"
TEST_TYPE = "server"
DEPENDENCIES = "servo_state:WORKING, servo_usb_state:NORMAL"

DOC = """
1.This test will check servo usbkey is detected correctly,
2.Then check whether a valid image is loaded on servo usbkey at beginning of the test.
3.Attempt download image if no valid image found in step 2.
4.If the servo usbkey is not detected, the test is aborted with the message
'No valid image found on servo usbkey and failed to download one.'.
"""

args_dict = utils.args_to_dict(args)
servo_args = hosts.CrosHost.get_servo_arguments(args_dict)

def run(machine):
    host = hosts.create_host(machine, servo_args=servo_args)
    job.run_test('platform_ServoPowerStateController', host=host,
                 usbkey_image_agnostic=True)

parallel_simple(run, machines)
