# Copyright 2019 The ChromiumOS Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

from autotest_lib.server import utils

AUTHOR = "seancarpenter, waihong"
NAME = "firmware_FAFTRPC.all"
METADATA = {
    "contacts": [
        "chromeos-faft@google.com",
        "seancarpenter@google.com",
        "waihong@chromium.org",
    ],
    "bug_component": "b:792402",  # ChromeOS > Platform > Enablement > Firmware > FAFT
    "criteria": "Verify that the RPC server, and all RPC functions, work as expected.",
}
ATTRIBUTES = "suite:infra_qual, suite:py3-beta"
DEPENDENCIES = "servo_state:WORKING"
TIME = "SHORT"
TEST_TYPE = "server"

DOC = """
This test checks that all RPC functions on all subsystems are connected,
and that they roughly work as expected.

This control file should not be automatically run.
Instead, each subsystem has its own control file.
That way, issues occurring in a particular subsystem will be easy to spot.
This control file is, however, useful for manual testing.

"""

args_dict = utils.args_to_dict(args)
servo_args = hosts.CrosHost.get_servo_arguments(args_dict)


def run_faftrpc(machine):
    host = hosts.create_host(machine, servo_args=servo_args)
    job.run_test(
        "firmware_FAFTRPC",
        host=host,
        cmdline_args=args,
        disable_sysinfo=True,
        category_under_test="*",
        tag="all",
    )


parallel_simple(run_faftrpc, machines)
